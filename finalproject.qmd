---
title: "Final Project"
author: "Majorz"
format: pdf
---

```{r read-data, message = F, warning = F}
library(tidyverse)
library(tidymodels)
library(glmnet)
library(Stat2Data)
spotify <- read_csv("data/tf_mini.csv")
```

```{r logistic-model, message = F, warning = F}
spotify_mode <- spotify |>
  mutate(new_mode = if_else(mode == "major", 1, 0), 
         new_mode = as.numeric(new_mode))

spotify_mode |> drop_na(new_mode)

glm_all_mode <- glm(new_mode ~ us_popularity_estimate + duration + release_year + acousticness + 
     beat_strength + bounciness + danceability + dyn_range_mean + energy + 
     flatness + instrumentalness + key + liveness + loudness + mechanism + 
       organism + speechiness + tempo + time_signature + valence,
     data = spotify_mode,
     family = "binomial")
summary(glm_all_mode)
```

```{r lasso, message = F, warning = F}
y <- spotify_mode$new_mode
x <- model.matrix(new_mode ~ us_popularity_estimate + duration + release_year + 
                acousticness + beat_strength + bounciness + danceability + 
                  dyn_range_mean + energy + flatness + instrumentalness + key + 
                  liveness + loudness + mechanism + organism + speechiness + 
                  tempo + time_signature + valence,
                  data = spotify_mode, family = "binomial")
lasso_sc <- cv.glmnet(x, y, alpha = 1)
best_lambda <- lasso_sc$lambda.min
lasso_final <- glmnet(x, y, alpha = 1, lambda = best_lambda)
lasso_final$beta
```

LASSO kept all of the predictors.

```{r lasso-plot, message = F, warning = F}
plot(lasso_sc)
```
not sure if this is needed or not^

## Introduction and Data

## Methodology

Evaluating assumptions:
```{r linearity-check, message = F, warning = F, echo = FALSE, eval = FALSE}
glm_aug <- augment(glm_all_mode) 
par(mfrow=c(4,5))
emplogitplot1(new_mode ~ us_popularity_estimate,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ duration,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ release_year,
             data = spotify_mode,
             ngroups = 5)
emplogitplot1(new_mode ~ acousticness,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ beat_strength,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ bounciness,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ danceability,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ dyn_range_mean,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ energy,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ flatness,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ instrumentalness,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ key,
             data = spotify_mode,
             ngroups = 10)
emplogitplot1(new_mode ~ liveness,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ loudness,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ mechanism,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ organism,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ speechiness,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ tempo,
             data = spotify_mode,
             ngroups = 20)
emplogitplot1(new_mode ~ time_signature,
             data = spotify_mode,
             ngroups = 2)
emplogitplot1(new_mode ~ valence,
             data = spotify_mode,
             ngroups = 20)
```

figure out to make this smaller or how to get charts to show^

There had to be less data points for some of the predictors because there was only so many different values and enough of them to be able to get the empirical logits. For example, with key there is only 12 unique values, but not all of them had enough values to be calculated, so we did 10 groups. I eliminated the titles to make the plots more clear and because they were repetitive. In summary, we concluded that linearity is met for ______ because there is no major pattern in empirical logits. Linearity was not met for ____ because ____.

## Results

HOW to pick which predictors are the best???

One predictor that makes sense to interpret is key because key has changes in whole numbers while many of the other predictors are within tenths of differences of each other amongst observations. Holding all other predictors constant, for every one (unit) increase in key, we expect the log-odds of a song being major rather than minor to increase by approximately 0.0931. So, when holding all other predictors constant, we for every one number increase in key (find what this means), the odds of the patient getting any infection is predicted to be multiplied by $e^{0.0931}$ = 1.0976. For an example, while holding all other predictors constant, the relative odds of a song being major rather than minor comparing a song with key 10 vs a song with key 2 is $e^{8*0.0931}$ is 2.106.

to be continued


## Discussion

